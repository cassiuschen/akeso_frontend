define(["jquery","underscore","form"],function(e,t,a){return{init:function(){return e("body").addClass("orders new"),this.handleNextBtn(),this.handleColorSelect(),window.UI=this},handleNextBtn:function(){var t;return t=this,e("#next").on("click",function(){var a;return console.log("click!"),"StepTwo"===e("#next").data("target")?(console.log("toStepTwo"),e(".step").removeClass("onStepOne"),e(".step").addClass("on"+e("#next").data("target")),e("#next").data("target","StepOne"),e(this).text("选择款式"),a=e("#step-1").height(),e("#step-1").hide(),e(this).data("layoutValue",e(".price").data("price")),setTimeout(function(){return e("#step-2").removeClass("hide").fadeIn(600).addClass("show"),t.selectionUI(),e("#sendCode").on("click",function(){return t.sendSMS()})},200)):(e("#step-1").show(),e("#step-2").fadeOut(600).addClass("hide").removeClass("show"),console.log("toStepOne"),e(".step").removeClass("onStepTwo"),e(".step").addClass("on"+e("#next").data("target")),e("#next").data("target","StepTwo"),e(this).text("填写信息"))})},handleColorSelect:function(){var t;return t=this,e(".colors .color").on("click",function(a){var n;return e(".color").addClass("mute"),e(".color.selected").removeClass("selected"),e("#next").removeAttr("disabled"),e(this).removeClass("mute").addClass("selected"),t.updatePrice(e(this).data("price")),n=e(this).parent().data("type"),e(".typeInput").text("已选款式："+e(this).data("name")+e(this).parent().data("typename")),e(".typeInput").data("type",e(this).parent().data("typename")),e(".typeInput").data("color",e(this).data("name")),e("#"+n).attr("src",e(this).data("img")),e("#preview").attr("src",e(this).data("preview"))})},selectionUI:function(){var t;return t=this,e(".selections .selection").on("click",function(){var a;return e(".selections input").val(e(this).text()),e(".selection.selected").removeClass("selected"),e(this).addClass("selected"),a=Number(e("#next").data("layoutValue")),t.updatePrice(a+Number(e(this).data("value")))})},updatePrice:function(t){return e(".price").data("price",t),e(".price").html("<span>价格</span>￥"+t),e(".price").addClass("priceChange"),setTimeout(function(){return e(".price").removeClass("priceChange")},800)},sendSMS:function(){var t,n,s;return s=this,e("#sendCode").attr("disabled","disabled"),t=e("input#mobile").val(),n={},e.ajax({type:"GET",url:"/leancloud/sendSMS/"+t,params:{mobile:t},data:{mobile:t},contentType:"application/json",dataType:"json",async:!1,success:function(t,o){return n=t,console.log(n.message),200===n.status?(e("#submit").removeAttr("disabled"),e("#submit").on("click",function(){return s.submit()})):a.getWarn("input#mobile","手机号似乎有点问题哦，请重新填写。",function(t){return e("#sendCode").removeAttr("disabled")})}})},getFormData:function(){var t;return t={},t.username=e("input#name").val(),t.smsCode=e("input#code").val(),t.mobilePhoneNumber=e("input#mobile").val(),t.email=e("input#email").val(),t.orders={type:e(".typeInput").data("type"),color:e(".typeInput").data("color"),glass:e("input#glass").val()},t},submit:function(){var t;return t=this,console.log(this.getFormData()),e.ajax({type:"POST",url:"/orders",params:t.getFormData(),data:JSON.stringify(t.getFormData()),contentType:"application/json",dataType:"json",success:function(e,t){return window.location="/orders/success"},error:function(e){return console.log(e)}})}}});