define(["jquery","underscore","form","navbar","modal"],function(e,t,a,o,r){return{init:function(){var t,a;return o.setActive("production"),window.formData={},window.formData.type=e(".gt").data("type"),window.formData.totalPrice=Number(e("#total").text()),window.formData.originPrice=Number(e("#total").text()),window.formData.color=e(".color.selected").text(),a=this,window.app=this,this.handleSelectGlass(),this.handleSelectColor(),t=new r("#info-modal"),e(".submit").on("click",function(){return t.show()}),e("#sendCode").on("click",function(){return a.sendSMS()})},handleSelectGlass:function(){var t;return t=this,e(".glass").on("click",function(a){var o;return e(".glass").removeClass("selected"),e(this).addClass("selected"),e(".glasses>.message").remove(),Number(e(this).data("price"))>0&&(o='<div class="message"><red>* </red>如果您的近视度数超过800或者散光度数超过200，需要单独定制镜片，价格会有变更，需要您联系我们的<a href="http://weibo.com/akesoeyecare">官方微博</a></div>',e(this).after(o)),window.formData.glass=e(this).children(".name").text(),window.formData.totalPrice=window.formData.originPrice+Number(e(this).data("price")),t.updateTotalPrice()})},handleSelectColor:function(){var t;return t=this,e(".color").on("click",function(t){return e(".color").removeClass("selected").addClass("mute"),e(this).removeClass("mute").addClass("selected"),e(".submit").removeAttr("disabled"),window.formData.color=e(this).text(),e("#colorImg").attr("src",e(this).data("img"))})},updateTotalPrice:function(){return e("#total").text(window.formData.totalPrice)},sendSMS:function(){var t,o,r;return r=this,e("#sendCode").attr("disabled","disabled"),t=e("input#mobile").val(),o={},e.ajax({type:"GET",url:"/leancloud/sendSMS/"+t,params:{mobile:t},data:{mobile:t},contentType:"application/json",dataType:"json",async:!1,success:function(t,n){return o=t,console.log(o.message),200===o.status?(e("#submit").removeAttr("disabled"),e("#submit").on("click",function(){return r.submit()})):a.getWarn("input#mobile","手机号似乎有点问题哦，请重新填写。",function(t){return e("#sendCode").removeAttr("disabled")})}})},getData:function(){var t;return t={},t.username=e("input#name").val(),t.smsCode=e("input#code").val(),t.mobilePhoneNumber=e("input#mobile").val(),t.email=e("input#email").val(),t.orders=window.formData,t.orders.province=e("input#province").val(),t},submit:function(){var t;return t=this,console.log(this.getData()),e.ajax({type:"POST",url:"/orders",params:t.getData(),data:JSON.stringify(t.getData()),contentType:"application/json",dataType:"json",success:function(e,t){return console.log(e),500===e.status?a.formWarning(".form",e.message):window.location="/orders/success"},error:function(e){return console.log(e)}})}}});